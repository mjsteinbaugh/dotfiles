# Tmux configuration
#
# set = set-option
# setw = set-window-option
#
# Check tmux environment:
# > tmux show-environment -g
#
# See also:
# - http://man.openbsd.org/OpenBSD-current/man1/tmux.1
# - https://github.com/claytron/dotfiles/blob/master/.tmux.conf
# - https://github.com/lotabout/dotfiles/blob/master/.tmux.conf
# - https://github.com/dariomanesku/.tmux/blob/master/.tmux.conf
# - https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
#
# This file uses folds in vim.
# https://vim.fandom.com/wiki/Folding



# Version-specific changes                                                  {{{1
# ==============================================================================

# See also:
# - Changelog
#   https://github.com/tmux/tmux/blob/master/CHANGES
# - How to write version-specific config
#   https://stackoverflow.com/questions/35016458

# tmux 2.1+ can selectively color the active pane.
# Can use xterm-256 colors or ANSI.
# - http://www.deanbodenham.com/learn/tmux-pane-colours.html
# - https://stackoverflow.com/a/33562182
# - https://upload.wikimedia.org/wikipedia/commons/1/15/Xterm_256color_chart.svg



# Global variables                                                          {{{1
# ==============================================================================
run-shell 'tmux setenv -g OS $(uname -s)'
run-shell 'tmux setenv -g TMUX_VERSION $(tmux -V | cut -d " " -f2)'



# General tmux settings                                                     {{{1
# ==============================================================================

# Force tmux to always use UTF-8.
setw -gq utf8 on

# Set the default terminal.
# This improves vim/emacs usage inside tmux.
# https://gist.github.com/limingjie/4975c36d13d0927613e6
# > set -g default-terminal "tmux"
# > set -g default-terminal "xterm-256color"
set -g default-terminal "screen-256color"

# Set the delay so that it doesn't interfere with programs like vim.
set -sg escape-time 0

# Set the scrollback.
set -g history-limit 200000



# Bindings                                                                  {{{1
# ==============================================================================

# Remap prefix from 'C-b' to 'C-a'.
# Matches the conventions used in screen.
# This might interfere with bash's go to beginning of line command.
set-option -g prefix C-a
unbind C-b
# Allow for C-a C-a to send it to the application.
bind-key C-a send-prefix

# Split panes using '|' and '-' instead of '"' and '%'.
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Use vi key bindings.
setw -g mode-keys vi

# Make window and pane indexes start with 1.
# Zero-indexing is confusing.
set -g base-index 1
setw -g pane-base-index 1

# Change bind keys.
# < 2.4: bind-key syntax changed in 2.4.
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.4" | bc)" = 1 ]' \
    "bind-key -t vi-copy v   begin-selection; \
     bind-key -t vi-copy V   select-line; \
     bind-key -t vi-copy C-v rectangle-toggle; \
     bind-key -t vi-copy y   copy-pipe 'xclip -selection clipboard -in'"
# >= 2.4
if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.4" | bc)" = 1 ]' \
    "bind-key -T copy-mode-vi v   send -X begin-selection; \
     bind-key -T copy-mode-vi V   send -X select-line; \
     bind-key -T copy-mode-vi C-v send -X rectangle-toggle; \
     bind-key -T copy-mode-vi y   send -X copy-pipe-and-cancel 'xclip -selection clipboard -in'"



# Copy mode                                                                 {{{1
# ==============================================================================

# This config doesn't work well on Windows with PuTTY or PowerShell, so disable.

# > bind-key -T copy-mode-vi Enter send-keys -X copy-pipe "pbcopy" \; display-message 'Text copied to clipboard!'
# > bind-key -T copy-mode-vi y send-keys -X copy-pipe "pbcopy" \; display-message 'Text copied to clipboard!'

# vim-like copy mode bindings
# from https://twitter.com/nickmorrott/status/928343075646210050?s=09
# > bind -T copy-mode-vi v send-keys -X begin-selection
# > bind -T copy-mode-vi V send-keys -X select-line
# > bind -T copy-mode-vi C-v send-keys -X rectangle-toggle \; send-keys -X begin-selection
# > bind -T copy-mode-vi Escape send-keys -X cancel



# Mouse mode                                                                {{{1
# ==============================================================================

# Renamed from `mouse-mode` to simply `mouse` in tmux v2.1.
# Note that this can conflict with vim mouse mode.

# PuTTY and PowerShell on Windows:
# Hold SHIFT, left-click select text, and right-click to paste.

# < 2.1
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.1" | bc)" = 1 ]' \
    "set -g mouse-select-pane on; \
     set -g mode-mouse on; \
     set -g mouse-resize-pane on; \
     set -g mouse-select-window on"
# >= 2.1: "mouse" replaced the previous 4 mouse options.
if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.1" | bc)" = 1 ]' \
    "set -g mouse on"
# 2.2+: UTF-8 is autodetected, but errors if explicitly set.
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.2" | bc)" = 1 ]' \
    "set -g utf8 on; \
     set -g status-utf8 on; \
     set -g mouse-utf8 on"

# Don't mark the window on right click.
# > unbind -T root MouseDown3Pane
# > bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"
# > bind -n WheelDownPane select-pane -t= \; send-keys -M

# Default is to copy and cancel selection.
# This copies to the clipboard and leaves the selection instead.
# > bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "pbcopy" \; display-message 'text copied to clipboard!'



# Status bar                                                                {{{1
# ==============================================================================

set -g status-fg white
set -g status-bg black



# Windows                                                                   {{{1
# ==============================================================================

# Don't hold the size of the smallest client bounds.
setw -g aggressive-resize on

# Notify if other windows have activity.
set -g visual-activity on
setw -g monitor-activity on

# Set inactive/active window styles.
# These are useful sometimes but can be distracting.
# > set -g window-style 'fg=colour247,bg=colour236'
# > set -g window-active-style 'fg=colour250,bg=black'

# Set window status aesthetics.
# < 2.9: The individual -fg, -bg and -attr options have been removed; they were
# superseded by -style options in tmux 1.9.
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.9" | bc)" = 1 ]' \
    "setw -g window-status-fg white \
     setw -g window-status-bg black \
     setw -g window-status-attr dim \
     setw -g window-status-current-fg black \
     setw -g window-status-current-bg magenta \
     setw -g window-status-current-attr bright \
     set -g pane-border-bg black \
     set -g pane-border-fg white \
     set -g pane-active-border-bg black \
     set -g pane-active-border-fg magenta"
if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.9" | bc)" = 1 ]' \
    "setw -g window-status-fg white \
     setw -g window-status-bg black \
     setw -g window-status-attr dim \
     setw -g window-status-current-fg black \
     setw -g window-status-current-bg magenta \
     setw -g window-status-current-attr bright \
     set -g pane-border-bg black \
     set -g pane-border-fg white \
     set -g pane-active-border-bg black \
     set -g pane-active-border-fg magenta"



# Experimental                                                              {{{1
# ==============================================================================

# Set default shell as ZSH instead of bash.
# > set -g default-shell /usr/local/bin/zsh
# > set -g default-command /usr/local/bin/zsh

# Allow renaming of window title.
# > setw -g automatic-rename on

# Set titles.
# > set -g set-titles on
# > set -g set-titles-string '#W' #T

# Set default directory path.
# > set-option default-path "$PWD"

# Set screen-like prefix.
# > set -g prefix ^t
# > bind-key ^t last-window

# Don't erase terminal contents on editor exit.
# > setw -g alternate-screen on



# turn on folds
# vim: fdm=marker
